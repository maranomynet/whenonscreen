// jQuery.fn.whenOnScreen 1.0  - MIT/GPL Licensed - More info: https://github.com/maranomynet/whenonscreen/
(function(e){var t=e(window),l,r=e.whenOnScreen={recalcOnResize:true,live:false,leftright:false,range:[{radius:50}],throttle:50},i=function(e,t){var l=/^(-?\d+(?:\.\d+)?)%(s|e)$/.exec(e);var r=l&&parseFloat(l[1])/100;var i=l&&(l[2]==="s"?"scr":"elm")+(/^[TB]/.test(t)?"Height":"Width");return l?function(e){return r*e[i]}:parseInt(e,10)||0},n=function(e,t,l,r,i){var n="_"+i;return!l&&e[n]!=null?e[n]:e[n]=t(r,i)},o=[],f=[],h,s,a=function(e){var l=t.scrollTop(),i=t.height(),o=l+i,a,c,m,g=e.push?e:f;for(var u=0,v;v=g[u];u++){var p=v.elm,d=v.live||r.recalcOnResize&&e.type==="resize",w=d&&p.offset(),L=d?v.elmTop=w.top:v.elmTop,R=d?v.elmHeight=p.outerHeight():v.elmHeight,B=d?v.elmBottom=L+R:v.elmBottom,H,T,W;if(v.leftright){if(!u){a=t.scrollLeft();c=t.width();m=a+c}H=d?v.elmLeft=w.left:v.elmLeft;T=d?v.elmWidth=p.outerWidth():v.elmWidth;W=d?v.elmRight=H+T:v.elmRight}var E={scrTop:l,scrHeight:i,scrBottom:o,scrLeft:a,scrWidth:c,scrRight:m,$elm:p,elmTop:L,elmHeight:R,elmBottom:B,elmLeft:H,elmWidth:T,elmRight:W,lastScrTop:h,lastScrLeft:s,leftright:v.leftright},O=0,S;while(S=v.ranges[O++]){var b,y=S.top,A=S.bottom;y.call&&(y=n(S,y,d,E,"top"));A.call&&(A=n(S,A,d,E,"bottom"));E.isElmBelow=L-y>=o;E.isElmAbove=l>=B+A;b=!E.isElmBelow&&!E.isElmAbove;if(v.leftright){var z=S.left,x=S.right;z.call&&(z=n(S,z,d,E,"left"));x.call&&(x=n(S,x,d,E,"right"));E.isElmRight=H-z>=m;E.isElmLeft=a>=W+x;b=b&&!E.isElmRight&&!E.isElmLeft}if(b!==S.onscreen){S.onscreen=b;E.type=b?"whenonscreen":"whenoffscreen";E.range=S;p.trigger(E)}}h=l;h=l}};e.fn.whenOnScreen=function(n,h){var s="run",c;if(typeof n==="string"){s=n;n=h}n=e.extend({},n);if(s==="run"){c=n.ranges!=null?n.ranges:r.ranges;c=e.isArray(c)?c:[{radius:c}];for(var m=0,g;g=c[m];m++){var u=g.radius||0;if(g.top==null){g.top=u}if(g.bottom==null){g.bottom=u}if(g.left==null){g.left=u}if(g.right==null){g.right=u}delete g.radius}}var v=this;this.each(function(){var t=this,l=e.inArray(t,o),h=l>-1;if(s==="stop"){if(h){o.splice(l,1);f.splice(l,1)}}else{var m={};if(h){m=f[l]}if(s==="data"){v=h?m:undefined;return false}if(s!=="recalc"){if(!h){o.push(t);f.push(m);m.elm=e(t)}m.leftright=n.leftright!=null?!!n.leftright:!!r.leftright;m.live=n.live!=null?!!n.live:!!r.live;m.ranges=[];e.each(c,function(){m.ranges.push(e.extend({},this))})}e.each(m.ranges,function(t,l){e.each(["Top","Bottom","Left","Right"],function(e,t){var r=t.toLowerCase(),n=l[r];l[r]=n.charAt?i(n,t):n;delete l["_"+r]})});if(!n.live&&(!h||s==="recalc")){var g=m.elm,u=g.offset();m.elmTop=u.top;m.elmHeight=g.outerHeight();m.elmBottom=u.top+m.elmHeight;if(m.leftright){m.elmLeft=u.left;m.elmWidth=g.outerWidth();m.elmRight=u.left+m.elmWidth}}if(s==="run"||!m.live){a([m])}}});if(!o.length){t.off(".whenOnScreen");l=false}else if(!l){l=true;t.on("scroll.whenOnScreen resize.whenOnScreen",e.throttleFn&&r.throttle?e.throttleFn(a,true,r.throttle):a)}return v}})(jQuery);
