// jQuery.fn.whenOnScreen 1.0  - MIT/GPL Licensed - More info: https://github.com/maranomynet/whenonscreen/
(function(e){var t=e(window),l,r=e.whenOnScreen={recalcOnResize:true,live:false,leftright:false,range:[{radius:50}],throttle:50},i=function(e,t){var l=/^(-?\d+(?:\.\d+)?)%(s|e)$/.exec(e);var r=l&&parseFloat(l[1])/100;var i=l&&(l[2]==="s"?"scr":"elm")+(/^[TB]/.test(t)?"Height":"Width");return l?function(e){return r*e[i]}:parseInt(e,10)||0},n=function(e,t,l,r,i){var n="_"+i;return!l&&e[n]!=null?e[n]:e[n]=t(r,i)},o=[],f=[],s,h,a=function(e){var l=t.scrollTop(),i=t.height(),o=l+i,a,c,g,u=e.push?e:f;for(var m=0,v;v=u[m];m++){var p=v.elm,d=v.live||r.recalcOnResize&&e.type==="resize",w=d&&p.offset(),L=d?w.top:v.elmTop,R=d?p.outerHeight():v.elmHeight,B=d?L+R:v.elmBottom,E,H,T;if(v.leftright){if(!m){a=t.scrollLeft();c=t.width();g=a+c}E=d?w.left:v.elmLeft;H=d?p.outerWidth():v.elmWidth;T=d?E+H:v.elmRight}var W={scrTop:l,scrHeight:i,scrBottom:o,scrLeft:a,scrWidth:c,scrRight:g,elmTop:L,elmHeight:R,elmBottom:B,elmLeft:E,elmWidth:H,elmRight:T,lastScrTop:s,lastScrLeft:h,leftright:v.leftright},O=0,S;while(S=v.ranges[O++]){var b,y=S.top,A=S.bottom;y.call&&(y=n(S,y,d,W,"top"));A.call&&(A=n(S,A,d,W,"bottom"));W.isElmBelow=L-y>=o;W.isElmAbove=l>=B+A;b=!W.isElmBelow&&!W.isElmAbove;if(v.leftright){var z=S.left,x=S.right;z.call&&(z=n(S,z,d,W,"left"));x.call&&(x=n(S,x,d,W,"right"));W.isElmRight=E-z>=g;W.isElmLeft=a>=T+x;b=b&&!W.isElmRight&&!W.isElmLeft}if(b!==S.onscreen){S.onscreen=b;W.type=b?"whenonscreen":"whenoffscreen";W.range=S;p.trigger(W)}}s=l;s=l}};e.fn.whenOnScreen=function(n,s){var h="run",c;if(typeof n==="string"){h=n;n=s}n=e.extend({},n);if(h==="run"){c=n.ranges!=null?n.ranges:r.ranges;c=e.isArray(c)?c:[{radius:c}];for(var g=0,u;u=c[g];g++){var m=u.radius||0;if(u.top==null){u.top=m}if(u.bottom==null){u.bottom=m}if(u.left==null){u.left=m}if(u.right==null){u.right=m}delete u.radius}}var v=this;this.each(function(){var t=this,l=e.inArray(t,o),s=l>-1;if(h==="stop"){if(s){o.splice(l,1);f.splice(l,1)}}else{var g={};if(s){g=f[l]}if(h==="data"){v=s?g:undefined;return false}if(h!=="recalc"){if(!s){o.push(t);f.push(g);g.elm=e(t)}g.leftright=n.leftright!=null?!!n.leftright:!!r.leftright;g.live=n.live!=null?!!n.live:!!r.live;g.ranges=[];e.each(c,function(){g.ranges.push(e.extend({},this))})}e.each(g.ranges,function(t,l){e.each(["Top","Bottom","Left","Right"],function(e,t){var r=t.toLowerCase(),n=l[r];l[r]=n.charAt?i(n,t):n;delete l["_"+r]})});if(!n.live&&(!s||h==="recalc")){var u=g.elm,m=u.offset();g.elmTop=m.top;g.elmHeight=u.outerHeight();g.elmBottom=m.top+g.elmHeight;if(g.leftright){g.elmLeft=m.left;g.elmWidth=u.outerWidth();g.elmRight=m.left+g.elmWidth}}if(h==="run"||!g.live){a([g])}}});if(!o.length){t.off(".whenOnScreen");l=false}else if(!l){l=true;t.on("scroll.whenOnScreen resize.whenOnScreen",e.throttleFn&&r.throttle?e.throttleFn(a,true,r.throttle):a)}return v}})(jQuery);
