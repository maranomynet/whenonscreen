// jQuery.fn.whenOnScreen 1.0  - MIT/GPL Licensed - More info: https://github.com/maranomynet/whenonscreen/
(function(e){var t=e(window),l,r=e.whenOnScreen={live:false,leftright:false,range:[{radius:50}],throttle:50},i=function(e,t){var l=/^(-?\d+(?:\.\d+)?)%(s|e)$/.exec(e);var r=l&&parseFloat(l[1])/100;var i=l&&(l[2]==="s"?"scr":"elm")+(/^[TB]/.test(t)?"Height":"Width");return l?function(e){return r*e[i]}:parseInt(e,10)||0},n=function(e,t,l,r){var i="_"+r;return!l.live&&e[i]!=null?e[i]:e[i]=t(l,r)},f=[],o=[],h,s,a=function(e){var l=t.scrollTop(),r=t.height(),i=l+r,f,a,c;e=e.push?e:o;for(var g=0,u;u=e[g];g++){var m=u.elm,v=u.live,p=v&&m.offset(),d=v?p.top:u.elmTop,w=v?m.outerHeight():u.elmHeight,L=v?d+w:u.elmBottom,B,E,H;if(u.leftright){if(!g){f=t.scrollLeft();a=t.width();c=f+a}B=v?p.left:u.elmLeft;E=v?m.outerWidth():u.elmWidth;H=v?B+E:u.elmRight}var T={scrTop:l,scrHeight:r,scrBottom:i,scrLeft:f,scrWidth:a,scrRight:c,elmTop:d,elmHeight:w,elmBottom:L,elmLeft:B,elmWidth:E,elmRight:H,lastScrTop:h,lastScrLeft:s,leftright:u.leftright,live:u.live},W=0,R;while(R=u.ranges[W++]){var S,b=R.top,y=R.bottom;b.call&&(b=n(R,b,T,"top"));y.call&&(y=n(R,y,T,"bottom"));T.isElmBelow=d-b>=i;T.isElmAbove=l>=L+y;S=!T.isElmBelow&&!T.isElmAbove;if(u.leftright){var A=R.left,O=R.right;A.call&&(A=n(R,A,T,"left"));O.call&&(O=n(R,O,T,"right"));T.isElmRight=B-A>=c;T.isElmLeft=f>=H+O;S=S&&!T.isElmRight&&!T.isElmLeft}if(S!==R.onscreen){R.onscreen=S;T.type=S?"whenonscreen":"whenoffscreen";T.range=R;m.trigger(T)}}h=l;h=l}};e.fn.whenOnScreen=function(n,h){var s="run",c;if(typeof n==="string"){s=n;n=h}n=e.extend({},n);if(s==="run"){c=n.ranges!=null?n.ranges:r.ranges;c=e.isArray(c)?c:[{radius:c}];for(var g=0,u;u=c[g];g++){var m=u.radius||0;if(u.top==null){u.top=m}if(u.bottom==null){u.bottom=m}if(u.left==null){u.left=m}if(u.right==null){u.right=m}delete u.radius}}var v=this;this.each(function(){var t=this,l=e.inArray(t,f),h=l>-1;if(s==="stop"){if(h){f.splice(l,1);o.splice(l,1)}}else{var g={};if(h){g=o[l]}if(s==="data"){v=h?g:undefined;return false}if(s!=="recalc"){if(!h){f.push(t);o.push(g);g.elm=e(t)}g.leftright=n.leftright!=null?!!n.leftright:!!r.leftright;g.live=n.live!=null?!!n.live:!!r.live;g.ranges=[];e.each(c,function(){g.ranges.push(e.extend({},this))})}e.each(g.ranges,function(t,l){e.each(["Top","Bottom","Left","Right"],function(e,t){var r=t.toLowerCase(),n=l[r];l[r]=n.charAt?i(n,t):n;delete l["_"+r]})});if(!n.live&&(!h||s==="recalc")){var u=g.elm,m=u.offset();g.elmTop=m.top;g.elmHeight=u.outerHeight();g.elmBottom=m.top+g.elmHeight;if(g.leftright){g.elmLeft=m.left;g.elmWidth=u.outerWidth();g.elmRight=m.left+g.elmWidth}}if(s==="run"||!g.live){a([g])}}});if(!f.length){t.off(".whenOnScreen");l=false}else if(!l){l=true;t.on("scroll.whenOnScreen resize.whenOnScreen",e.throttleFn&&r.throttle?e.throttleFn(a,true,r.throttle):a)}return v}})(jQuery);
